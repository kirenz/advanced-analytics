<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 17 Create recipe and roles | Advanced Analytics with Tidymodels in R</title>
  <meta name="description" content="How to build, evaluate, compare, and tune predictive models with Tidymodels in R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 17 Create recipe and roles | Advanced Analytics with Tidymodels in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="How to build, evaluate, compare, and tune predictive models with Tidymodels in R." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 17 Create recipe and roles | Advanced Analytics with Tidymodels in R" />
  
  <meta name="twitter:description" content="How to build, evaluate, compare, and tune predictive models with Tidymodels in R." />
  

<meta name="author" content="Prof. Dr. Jan Kirenz" />


<meta name="date" content="2020-12-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-splitting-3.html"/>
<link rel="next" href="model-building-3.html"/>
<script src="libs/header-attrs-2.5/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Advanced Analytics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I BUILD A MODEL</b></span></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-understanding.html"><a href="data-understanding.html"><i class="fa fa-check"></i><b>2</b> Data understanding</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-understanding.html"><a href="data-understanding.html#imort-data"><i class="fa fa-check"></i><b>2.1</b> Imort Data</a></li>
<li class="chapter" data-level="2.2" data-path="data-understanding.html"><a href="data-understanding.html#data-overview"><i class="fa fa-check"></i><b>2.2</b> Data overview</a></li>
<li class="chapter" data-level="2.3" data-path="data-understanding.html"><a href="data-understanding.html#data-splitting"><i class="fa fa-check"></i><b>2.3</b> Data splitting</a></li>
<li class="chapter" data-level="2.4" data-path="data-understanding.html"><a href="data-understanding.html#data-exploration"><i class="fa fa-check"></i><b>2.4</b> Data exploration</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>3</b> Model building</a>
<ul>
<li class="chapter" data-level="3.1" data-path="model-building.html"><a href="model-building.html#model-specification"><i class="fa fa-check"></i><b>3.1</b> Model specification</a></li>
<li class="chapter" data-level="3.2" data-path="model-building.html"><a href="model-building.html#model-training"><i class="fa fa-check"></i><b>3.2</b> Model training</a></li>
<li class="chapter" data-level="3.3" data-path="model-building.html"><a href="model-building.html#model-predictions"><i class="fa fa-check"></i><b>3.3</b> Model predictions</a></li>
<li class="chapter" data-level="3.4" data-path="model-building.html"><a href="model-building.html#model-evaluation"><i class="fa fa-check"></i><b>3.4</b> Model evaluation</a></li>
</ul></li>
<li class="part"><span><b>II RESAMPLING</b></span></li>
<li class="chapter" data-level="4" data-path="validation-set.html"><a href="validation-set.html"><i class="fa fa-check"></i><b>4</b> Validation set</a></li>
<li class="chapter" data-level="5" data-path="data-understanding-1.html"><a href="data-understanding-1.html"><i class="fa fa-check"></i><b>5</b> Data understanding</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-understanding-1.html"><a href="data-understanding-1.html#import-data"><i class="fa fa-check"></i><b>5.1</b> Import data</a></li>
<li class="chapter" data-level="5.2" data-path="data-understanding-1.html"><a href="data-understanding-1.html#data-splitting-1"><i class="fa fa-check"></i><b>5.2</b> Data splitting</a></li>
<li class="chapter" data-level="5.3" data-path="data-understanding-1.html"><a href="data-understanding-1.html#validation-set-1"><i class="fa fa-check"></i><b>5.3</b> Validation set</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="model-building-1.html"><a href="model-building-1.html"><i class="fa fa-check"></i><b>6</b> Model building</a>
<ul>
<li class="chapter" data-level="6.1" data-path="model-building-1.html"><a href="model-building-1.html#model-specification-1"><i class="fa fa-check"></i><b>6.1</b> Model specification</a></li>
<li class="chapter" data-level="6.2" data-path="model-building-1.html"><a href="model-building-1.html#evaluate-models"><i class="fa fa-check"></i><b>6.2</b> Evaluate models</a></li>
<li class="chapter" data-level="6.3" data-path="model-building-1.html"><a href="model-building-1.html#fit-model-1"><i class="fa fa-check"></i><b>6.3</b> Fit model 1</a></li>
<li class="chapter" data-level="6.4" data-path="model-building-1.html"><a href="model-building-1.html#fit-model-2"><i class="fa fa-check"></i><b>6.4</b> Fit model 2</a></li>
<li class="chapter" data-level="6.5" data-path="model-building-1.html"><a href="model-building-1.html#performance-metrics"><i class="fa fa-check"></i><b>6.5</b> Performance metrics</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="train-best-model.html"><a href="train-best-model.html"><i class="fa fa-check"></i><b>7</b> Train best model</a></li>
<li class="chapter" data-level="8" data-path="evaluate-final-model.html"><a href="evaluate-final-model.html"><i class="fa fa-check"></i><b>8</b> Evaluate final model</a></li>
<li class="part"><span><b>III RECIPES</b></span></li>
<li class="chapter" data-level="9" data-path="data-preprocessing.html"><a href="data-preprocessing.html"><i class="fa fa-check"></i><b>9</b> Data preprocessing</a></li>
<li class="chapter" data-level="10" data-path="data-understanding-2.html"><a href="data-understanding-2.html"><i class="fa fa-check"></i><b>10</b> Data understanding</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-understanding-2.html"><a href="data-understanding-2.html#import-data-1"><i class="fa fa-check"></i><b>10.1</b> Import data</a></li>
<li class="chapter" data-level="10.2" data-path="data-understanding-2.html"><a href="data-understanding-2.html#data-splitting-2"><i class="fa fa-check"></i><b>10.2</b> Data splitting</a></li>
<li class="chapter" data-level="10.3" data-path="data-understanding-2.html"><a href="data-understanding-2.html#validation-set-2"><i class="fa fa-check"></i><b>10.3</b> Validation set</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-preparation.html"><a href="data-preparation.html"><i class="fa fa-check"></i><b>11</b> Data preparation</a>
<ul>
<li class="chapter" data-level="11.1" data-path="data-preparation.html"><a href="data-preparation.html#recipe"><i class="fa fa-check"></i><b>11.1</b> recipe()</a></li>
<li class="chapter" data-level="11.2" data-path="data-preparation.html"><a href="data-preparation.html#helper-functions"><i class="fa fa-check"></i><b>11.2</b> Helper functions</a></li>
<li class="chapter" data-level="11.3" data-path="data-preparation.html"><a href="data-preparation.html#step_novel"><i class="fa fa-check"></i><b>11.3</b> step_novel()</a></li>
<li class="chapter" data-level="11.4" data-path="data-preparation.html"><a href="data-preparation.html#step_dummy"><i class="fa fa-check"></i><b>11.4</b> step_dummy()</a></li>
<li class="chapter" data-level="11.5" data-path="data-preparation.html"><a href="data-preparation.html#step_zv"><i class="fa fa-check"></i><b>11.5</b> step_zv()</a></li>
<li class="chapter" data-level="11.6" data-path="data-preparation.html"><a href="data-preparation.html#step_normalize"><i class="fa fa-check"></i><b>11.6</b> step_normalize()</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="model-building-2.html"><a href="model-building-2.html"><i class="fa fa-check"></i><b>12</b> Model building</a>
<ul>
<li class="chapter" data-level="12.1" data-path="model-building-2.html"><a href="model-building-2.html#specify-model"><i class="fa fa-check"></i><b>12.1</b> Specify model</a></li>
<li class="chapter" data-level="12.2" data-path="model-building-2.html"><a href="model-building-2.html#create-workflow"><i class="fa fa-check"></i><b>12.2</b> Create workflow</a></li>
<li class="chapter" data-level="12.3" data-path="model-building-2.html"><a href="model-building-2.html#evaluate-model"><i class="fa fa-check"></i><b>12.3</b> Evaluate model</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="train-model.html"><a href="train-model.html"><i class="fa fa-check"></i><b>13</b> Train model</a></li>
<li class="chapter" data-level="14" data-path="evaluate-model-1.html"><a href="evaluate-model-1.html"><i class="fa fa-check"></i><b>14</b> Evaluate model</a></li>
<li class="part"><span><b>IV WORKFLOWS &amp; MODELS</b></span></li>
<li class="chapter" data-level="15" data-path="data-preparation-1.html"><a href="data-preparation-1.html"><i class="fa fa-check"></i><b>15</b> Data preparation</a>
<ul>
<li class="chapter" data-level="15.1" data-path="data-preparation-1.html"><a href="data-preparation-1.html#data-overview-1"><i class="fa fa-check"></i><b>15.1</b> Data overview</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="data-splitting-3.html"><a href="data-splitting-3.html"><i class="fa fa-check"></i><b>16</b> Data splitting</a></li>
<li class="chapter" data-level="17" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html"><i class="fa fa-check"></i><b>17</b> Create recipe and roles</a>
<ul>
<li class="chapter" data-level="17.1" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html#create-features"><i class="fa fa-check"></i><b>17.1</b> Create features</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html#date"><i class="fa fa-check"></i><b>17.1.1</b> Date</a></li>
<li class="chapter" data-level="17.1.2" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html#dummy-variables"><i class="fa fa-check"></i><b>17.1.2</b> Dummy variables</a></li>
<li class="chapter" data-level="17.1.3" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html#zero-variance"><i class="fa fa-check"></i><b>17.1.3</b> Zero variance</a></li>
<li class="chapter" data-level="17.1.4" data-path="create-recipe-and-roles.html"><a href="create-recipe-and-roles.html#correlations"><i class="fa fa-check"></i><b>17.1.4</b> Correlations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="model-building-3.html"><a href="model-building-3.html"><i class="fa fa-check"></i><b>18</b> Model building</a>
<ul>
<li class="chapter" data-level="18.1" data-path="model-building-3.html"><a href="model-building-3.html#logistic-regression"><i class="fa fa-check"></i><b>18.1</b> Logistic regression</a></li>
<li class="chapter" data-level="18.2" data-path="model-building-3.html"><a href="model-building-3.html#decision-tree"><i class="fa fa-check"></i><b>18.2</b> Decision tree</a></li>
<li class="chapter" data-level="18.3" data-path="model-building-3.html"><a href="model-building-3.html#random-forest"><i class="fa fa-check"></i><b>18.3</b> Random forest</a></li>
<li class="chapter" data-level="18.4" data-path="model-building-3.html"><a href="model-building-3.html#boosted-tree-xgboost"><i class="fa fa-check"></i><b>18.4</b> Boosted tree (XGBoost)</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="recipe-and-models.html"><a href="recipe-and-models.html"><i class="fa fa-check"></i><b>19</b> Recipe and Models</a>
<ul>
<li class="chapter" data-level="19.1" data-path="recipe-and-models.html"><a href="recipe-and-models.html#fit-models-with-workflows"><i class="fa fa-check"></i><b>19.1</b> Fit models with workflows</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="recipe-and-models.html"><a href="recipe-and-models.html#logistic-regression-1"><i class="fa fa-check"></i><b>19.1.1</b> Logistic regression</a></li>
<li class="chapter" data-level="19.1.2" data-path="recipe-and-models.html"><a href="recipe-and-models.html#decision-tree-1"><i class="fa fa-check"></i><b>19.1.2</b> Decision tree</a></li>
<li class="chapter" data-level="19.1.3" data-path="recipe-and-models.html"><a href="recipe-and-models.html#random-forest-1"><i class="fa fa-check"></i><b>19.1.3</b> Random forest</a></li>
<li class="chapter" data-level="19.1.4" data-path="recipe-and-models.html"><a href="recipe-and-models.html#xgboost"><i class="fa fa-check"></i><b>19.1.4</b> XGBoost</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="recipe-and-models.html"><a href="recipe-and-models.html#train-models"><i class="fa fa-check"></i><b>19.2</b> Train models</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="recipe-and-models.html"><a href="recipe-and-models.html#logistic-regression-2"><i class="fa fa-check"></i><b>19.2.1</b> Logistic regression</a></li>
<li class="chapter" data-level="19.2.2" data-path="recipe-and-models.html"><a href="recipe-and-models.html#decision-tree-2"><i class="fa fa-check"></i><b>19.2.2</b> Decision tree</a></li>
<li class="chapter" data-level="19.2.3" data-path="recipe-and-models.html"><a href="recipe-and-models.html#random-forest-2"><i class="fa fa-check"></i><b>19.2.3</b> Random forest</a></li>
<li class="chapter" data-level="19.2.4" data-path="recipe-and-models.html"><a href="recipe-and-models.html#xg-boost"><i class="fa fa-check"></i><b>19.2.4</b> XG Boost</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="recipe-and-models.html"><a href="recipe-and-models.html#model-recipe-objects"><i class="fa fa-check"></i><b>19.3</b> Model recipe objects</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="recipe-and-models.html"><a href="recipe-and-models.html#logistic-regression-3"><i class="fa fa-check"></i><b>19.3.1</b> Logistic regression</a></li>
<li class="chapter" data-level="19.3.2" data-path="recipe-and-models.html"><a href="recipe-and-models.html#decision-tree-3"><i class="fa fa-check"></i><b>19.3.2</b> Decision tree</a></li>
<li class="chapter" data-level="19.3.3" data-path="recipe-and-models.html"><a href="recipe-and-models.html#random-forest-3"><i class="fa fa-check"></i><b>19.3.3</b> Random forest</a></li>
<li class="chapter" data-level="19.3.4" data-path="recipe-and-models.html"><a href="recipe-and-models.html#xg-boost-1"><i class="fa fa-check"></i><b>19.3.4</b> XG Boost</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="recipe-and-models.html"><a href="recipe-and-models.html#summary"><i class="fa fa-check"></i><b>19.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="prediction.html"><a href="prediction.html"><i class="fa fa-check"></i><b>20</b> Prediction</a>
<ul>
<li class="chapter" data-level="20.1" data-path="prediction.html"><a href="prediction.html#logistic-regression-4"><i class="fa fa-check"></i><b>20.1</b> Logistic regression</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="prediction.html"><a href="prediction.html#roc-curve"><i class="fa fa-check"></i><b>20.1.1</b> ROC curve</a></li>
<li class="chapter" data-level="20.1.2" data-path="prediction.html"><a href="prediction.html#auc"><i class="fa fa-check"></i><b>20.1.2</b> AUC</a></li>
<li class="chapter" data-level="20.1.3" data-path="prediction.html"><a href="prediction.html#accuracy"><i class="fa fa-check"></i><b>20.1.3</b> Accuracy</a></li>
<li class="chapter" data-level="20.1.4" data-path="prediction.html"><a href="prediction.html#recall"><i class="fa fa-check"></i><b>20.1.4</b> Recall</a></li>
<li class="chapter" data-level="20.1.5" data-path="prediction.html"><a href="prediction.html#precision"><i class="fa fa-check"></i><b>20.1.5</b> Precision</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced Analytics with Tidymodels in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="create-recipe-and-roles" class="section level1" number="17">
<h1><span class="header-section-number">Chapter 17</span> Create recipe and roles</h1>
<p>To get started, let’s create a recipe for a classification model. Before training the models, we can use a recipe to create a few new predictors and conduct some preprocessing required by the model.</p>
<p>The <code>recipe()</code> function has two arguments:</p>
<ul>
<li><p><em>A formula</em>. Any variable on the left-hand side of the tilde (~) is considered the model outcome (here, <code>arr_delay</code>). On the right-hand side of the tilde are the predictors. Variables may be listed by name, or you can use the dot (.) to indicate all other variables as predictors.</p></li>
<li><p><em>The data</em>. A recipe is associated with the data set used to create the model. This will typically be the training set, so <code>data = train_data</code> here. Naming a data set doesn’t actually change the data itself; it is only used to catalog the names of the variables and their types, like factors, integers, dates, etc.</p></li>
</ul>
<p>We can also add roles to this recipe. We can use the <code>update_role()</code> function to let recipes know that <code>flight</code> and <code>time_hour</code> are variables with a custom role that we call “ID” (a role can have any character value). Whereas our formula included all variables in the training set other than <code>arr_delay</code> as predictors, this tells the recipe to keep these two variables but not use them as either outcomes or predictors.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="create-recipe-and-roles.html#cb75-1" aria-hidden="true" tabindex="-1"></a>flights_rec <span class="ot">&lt;-</span> </span>
<span id="cb75-2"><a href="create-recipe-and-roles.html#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(arr_delay <span class="sc">~</span> ., <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="create-recipe-and-roles.html#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(flight, </span>
<span id="cb75-4"><a href="create-recipe-and-roles.html#cb75-4" aria-hidden="true" tabindex="-1"></a>              time_hour, </span>
<span id="cb75-5"><a href="create-recipe-and-roles.html#cb75-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) </span></code></pre></div>
<p>This step of adding roles to a recipe is optional; the purpose of using it here is that those two variables can be retained in the data but not included in the model. This can be convenient when, after the model is fit, we want to investigate some poorly predicted value. These ID columns will be available and can be used to try to understand what went wrong.</p>
<p>To get the current set of variables and roles, use the summary() function:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="create-recipe-and-roles.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(flights_rec)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    variable  type    role      source  
##    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;   
##  1 dep_time  numeric predictor original
##  2 flight    numeric ID        original
##  3 origin    nominal predictor original
##  4 dest      nominal predictor original
##  5 air_time  numeric predictor original
##  6 distance  numeric predictor original
##  7 carrier   nominal predictor original
##  8 date      date    predictor original
##  9 time_hour date    ID        original
## 10 arr_delay nominal outcome   original</code></pre>
<div id="create-features" class="section level2" number="17.1">
<h2><span class="header-section-number">17.1</span> Create features</h2>
<p>Now we can start adding steps onto our recipe using the pipe operator.</p>
<div id="date" class="section level3" number="17.1.1">
<h3><span class="header-section-number">17.1.1</span> Date</h3>
<p>Perhaps it is reasonable for the <code>date</code> of the flight to have an effect on the likelihood of a late arrival. A little bit of feature engineering might go a long way to improving our model. How should the date be encoded into the model? The date column has an R date object so including that column “as is” will mean that the model will convert it to a numeric format equal to the number of days after a reference date:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="create-recipe-and-roles.html#cb78-1" aria-hidden="true" tabindex="-1"></a>flight_data <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="create-recipe-and-roles.html#cb78-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb78-3"><a href="create-recipe-and-roles.html#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">numeric_date =</span> <span class="fu">as.numeric</span>(date)) </span></code></pre></div>
<pre><code>## # A tibble: 364 x 2
##    date       numeric_date
##    &lt;date&gt;            &lt;dbl&gt;
##  1 2013-05-03        15828
##  2 2013-03-04        15768
##  3 2013-02-20        15756
##  4 2013-04-02        15797
##  5 2013-06-13        15869
##  6 2013-02-21        15757
##  7 2013-05-08        15833
##  8 2013-10-21        15999
##  9 2013-11-12        16021
## 10 2013-09-12        15960
## # … with 354 more rows</code></pre>
<p>It’s possible that the numeric date variable is a good option for modeling. However, it might be better to add model terms derived from the date that have a better potential to be important to the model. For example, we could derive the following meaningful features from the single date variable:</p>
<ul>
<li>the day of the week,</li>
<li>the month, and</li>
<li>whether or not the date corresponds to a holiday.</li>
</ul>
<p>Let’s do all three of these by adding steps to our recipe:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="create-recipe-and-roles.html#cb80-1" aria-hidden="true" tabindex="-1"></a>flights_rec <span class="ot">&lt;-</span> </span>
<span id="cb80-2"><a href="create-recipe-and-roles.html#cb80-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(arr_delay <span class="sc">~</span> ., </span>
<span id="cb80-3"><a href="create-recipe-and-roles.html#cb80-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="create-recipe-and-roles.html#cb80-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(flight, </span>
<span id="cb80-5"><a href="create-recipe-and-roles.html#cb80-5" aria-hidden="true" tabindex="-1"></a>              time_hour, </span>
<span id="cb80-6"><a href="create-recipe-and-roles.html#cb80-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-7"><a href="create-recipe-and-roles.html#cb80-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, </span>
<span id="cb80-8"><a href="create-recipe-and-roles.html#cb80-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span>               </span>
<span id="cb80-9"><a href="create-recipe-and-roles.html#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_holiday</span>(date, </span>
<span id="cb80-10"><a href="create-recipe-and-roles.html#cb80-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">holidays =</span> timeDate<span class="sc">::</span><span class="fu">listHolidays</span>(<span class="st">&quot;US&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb80-11"><a href="create-recipe-and-roles.html#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date)</span></code></pre></div>
<p>What do each of these steps do?</p>
<ul>
<li><p>With <code>step_date()</code>, we created two new factor columns with the appropriate day of the week (dow) and the month.</p></li>
<li><p>With <code>step_holiday()</code>, we created a binary variable indicating whether the current date is a holiday or not. The argument value of <code>timeDate::listHolidays("US"</code>) uses the timeDate package to list the 17 standard US holidays.</p></li>
<li><p>With <code>step_rm()</code>, we remove the original date variable since we no longer want it in the model.</p></li>
</ul>
<p>Next, we’ll turn our attention to the variable types of our predictors. Because we plan to train a classifiaction model, we know that predictors will ultimately need to be numeric, as opposed to factor variables. In other words, there may be a difference in how we store our data (in factors inside a data frame), and how the underlying equations require them (a purely numeric matrix).</p>
</div>
<div id="dummy-variables" class="section level3" number="17.1.2">
<h3><span class="header-section-number">17.1.2</span> Dummy variables</h3>
<p>For factors like <code>dest</code> and <code>origin</code>, standard practice is to convert them into <em>dummy</em> or indicator variables to make them numeric. These are binary values for each level of the factor. For example, our origin variable has values of “EWR,” “JFK,” and “LGA.” The standard dummy variable encoding, shown below, will create two numeric columns of the data that are 1 when the originating airport is “JFK” or “LGA” and zero otherwise, respectively.</p>
<table>
<thead>
<tr class="header">
<th>ORIGIN</th>
<th>ORIGIN_JFK</th>
<th>ORIGIN_LGA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>EWR</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>JFK</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="odd">
<td>LGA</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table>
<p>But, unlike the standard model formula methods in R, a recipe does not automatically create these dummy variables for you; you’ll need to tell your recipe to add this step. This is for two reasons. First, many models do not require numeric predictors, so dummy variables may not always be preferred. Second, recipes can also be used for purposes outside of modeling, where non-dummy versions of the variables may work better. For example, you may want to make a table or a plot with a variable as a single factor. For those reasons, you need to explicitly tell recipes to create dummy variables using step_dummy():</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="create-recipe-and-roles.html#cb81-1" aria-hidden="true" tabindex="-1"></a>flights_rec <span class="ot">&lt;-</span> </span>
<span id="cb81-2"><a href="create-recipe-and-roles.html#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(arr_delay <span class="sc">~</span> ., </span>
<span id="cb81-3"><a href="create-recipe-and-roles.html#cb81-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span></span>
<span id="cb81-4"><a href="create-recipe-and-roles.html#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(flight, </span>
<span id="cb81-5"><a href="create-recipe-and-roles.html#cb81-5" aria-hidden="true" tabindex="-1"></a>              time_hour, </span>
<span id="cb81-6"><a href="create-recipe-and-roles.html#cb81-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb81-7"><a href="create-recipe-and-roles.html#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, </span>
<span id="cb81-8"><a href="create-recipe-and-roles.html#cb81-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-9"><a href="create-recipe-and-roles.html#cb81-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_holiday</span>(date, </span>
<span id="cb81-10"><a href="create-recipe-and-roles.html#cb81-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">holidays =</span> timeDate<span class="sc">::</span><span class="fu">listHolidays</span>(<span class="st">&quot;US&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb81-11"><a href="create-recipe-and-roles.html#cb81-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb81-12"><a href="create-recipe-and-roles.html#cb81-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>())</span></code></pre></div>
<p>Here, we did something different than before: instead of applying a step to an individual variable, we used selectors to apply this recipe step to several variables at once.</p>
<ul>
<li><p>The first selector, <code>all_nominal()</code>, selects all variables that are either factors or characters.</p></li>
<li><p>The second selector, <code>-all_outcomes()</code> removes any outcome variables from this recipe step.</p></li>
</ul>
<p>With these two selectors together, our recipe step above translates to:</p>
<blockquote>
<p>Create dummy variables for all of the factor or character columns unless they are outcomes.</p>
</blockquote>
<p>At this stage in the recipe, this step selects the <code>origin</code>, <code>dest</code>, and <code>carrier</code> variables. It also includes two new variables, <code>date_dow</code> and <code>date_month</code>, that were created by the earlier <code>step_date()</code>.</p>
<p>More generally, the recipe selectors mean that you don’t always have to apply steps to individual variables one at a time. Since a recipe knows the variable type and role of each column, they can also be selected (or dropped) using this information.</p>
</div>
<div id="zero-variance" class="section level3" number="17.1.3">
<h3><span class="header-section-number">17.1.3</span> Zero variance</h3>
<p>Note that since <code>carrier</code> and <code>dest</code> have some infrequently occurring values, it is possible that dummy variables might be created for values that don’t exist in the training set. For example, there could be destinations that are only in the test set. The function <a href="https://dplyr.tidyverse.org/reference/join.html"><code>anti_join()</code></a> returns all rows from x (test_data) where there are not matching values in y (train_data), keeping just columns from x.:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="create-recipe-and-roles.html#cb82-1" aria-hidden="true" tabindex="-1"></a>test_data <span class="sc">%&gt;%</span> </span>
<span id="cb82-2"><a href="create-recipe-and-roles.html#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(dest) <span class="sc">%&gt;%</span> </span>
<span id="cb82-3"><a href="create-recipe-and-roles.html#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(train_data)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   dest 
##   &lt;fct&gt;
## 1 HDN</code></pre>
<p>When the recipe is applied to the training set, a column could contain only zeros. This is a “<em>zero-variance predictor</em>” that has no information within the column. While some R functions will not produce an error for such predictors, it usually causes warnings and other issues. <code>step_zv()</code> will remove columns from the data when the training set data have a single value, so it is added to the recipe after <code>step_dummy()</code>:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="create-recipe-and-roles.html#cb84-1" aria-hidden="true" tabindex="-1"></a>flights_rec <span class="ot">&lt;-</span> </span>
<span id="cb84-2"><a href="create-recipe-and-roles.html#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(arr_delay <span class="sc">~</span> ., </span>
<span id="cb84-3"><a href="create-recipe-and-roles.html#cb84-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span> </span>
<span id="cb84-4"><a href="create-recipe-and-roles.html#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(flight, </span>
<span id="cb84-5"><a href="create-recipe-and-roles.html#cb84-5" aria-hidden="true" tabindex="-1"></a>              time_hour, </span>
<span id="cb84-6"><a href="create-recipe-and-roles.html#cb84-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-7"><a href="create-recipe-and-roles.html#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, </span>
<span id="cb84-8"><a href="create-recipe-and-roles.html#cb84-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb84-9"><a href="create-recipe-and-roles.html#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_holiday</span>(date, </span>
<span id="cb84-10"><a href="create-recipe-and-roles.html#cb84-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">holidays =</span> timeDate<span class="sc">::</span><span class="fu">listHolidays</span>(<span class="st">&quot;US&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb84-11"><a href="create-recipe-and-roles.html#cb84-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb84-12"><a href="create-recipe-and-roles.html#cb84-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb84-13"><a href="create-recipe-and-roles.html#cb84-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
</div>
<div id="correlations" class="section level3" number="17.1.4">
<h3><span class="header-section-number">17.1.4</span> Correlations</h3>
<p>As a final step, we remove predictor variables that have large absolute correlations with other variables</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="create-recipe-and-roles.html#cb85-1" aria-hidden="true" tabindex="-1"></a>flights_rec <span class="ot">&lt;-</span> </span>
<span id="cb85-2"><a href="create-recipe-and-roles.html#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(arr_delay <span class="sc">~</span> ., </span>
<span id="cb85-3"><a href="create-recipe-and-roles.html#cb85-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">data =</span> train_data) <span class="sc">%&gt;%</span> </span>
<span id="cb85-4"><a href="create-recipe-and-roles.html#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update_role</span>(flight, </span>
<span id="cb85-5"><a href="create-recipe-and-roles.html#cb85-5" aria-hidden="true" tabindex="-1"></a>              time_hour, </span>
<span id="cb85-6"><a href="create-recipe-and-roles.html#cb85-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">new_role =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb85-7"><a href="create-recipe-and-roles.html#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_date</span>(date, </span>
<span id="cb85-8"><a href="create-recipe-and-roles.html#cb85-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">features =</span> <span class="fu">c</span>(<span class="st">&quot;dow&quot;</span>, <span class="st">&quot;month&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb85-9"><a href="create-recipe-and-roles.html#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_holiday</span>(date, </span>
<span id="cb85-10"><a href="create-recipe-and-roles.html#cb85-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">holidays =</span> timeDate<span class="sc">::</span><span class="fu">listHolidays</span>(<span class="st">&quot;US&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb85-11"><a href="create-recipe-and-roles.html#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_rm</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb85-12"><a href="create-recipe-and-roles.html#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>(), <span class="sc">-</span><span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb85-13"><a href="create-recipe-and-roles.html#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb85-14"><a href="create-recipe-and-roles.html#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_corr</span>(<span class="fu">all_predictors</span>())</span></code></pre></div>
<p>Now we’ve created a specification of what should be done with the data.</p>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-splitting-3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="model-building-3.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["advanced-analytics.pdf", "advanced-analytics.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
